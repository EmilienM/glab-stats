<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guide â€” Dev Pulse</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .guide {
      max-width: 780px;
      margin: 0 auto;
      padding: 2rem 1.5rem 4rem;
    }
    .guide h2 {
      font-size: 1.15rem;
      font-weight: 700;
      color: var(--accent);
      margin: 2rem 0 0.5rem;
      padding-bottom: 0.35rem;
      border-bottom: 1px solid var(--border);
    }
    .guide h2:first-of-type { margin-top: 1rem; }
    .guide p, .guide li {
      font-size: 0.9rem;
      color: var(--text-secondary);
      line-height: 1.7;
    }
    .guide ul { padding-left: 1.25rem; margin: 0.4rem 0; }
    .guide li { margin-bottom: 0.25rem; }
    .guide code {
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      font-size: 0.82rem;
      background: var(--bg-tertiary);
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      color: var(--text-primary);
    }
    .guide pre {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 0.85rem 1rem;
      overflow-x: auto;
      margin: 0.5rem 0 1rem;
      font-size: 0.8rem;
      line-height: 1.5;
      color: var(--text-primary);
    }
    .guide table {
      width: 100%;
      border-collapse: collapse;
      margin: 0.5rem 0 1rem;
      font-size: 0.82rem;
    }
    .guide th, .guide td {
      text-align: left;
      padding: 0.45rem 0.75rem;
      border: 1px solid var(--border);
    }
    .guide th {
      background: var(--bg-tertiary);
      font-weight: 700;
      color: var(--text-primary);
    }
    .guide td { color: var(--text-secondary); }
    .guide .back-link {
      display: inline-block;
      font-size: 0.85rem;
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
    }
    .guide .back-link:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <h1 class="header-title">Guide</h1>
      <div class="header-actions">
        <a href="index.html" class="btn-export" style="text-decoration:none;display:inline-flex;align-items:center;">Dashboard</a>
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
          <span class="theme-icon" id="theme-icon">&#9790;</span>
        </button>
      </div>
    </div>
  </header>

  <div class="guide">
    <a href="index.html" class="back-link">&larr; Back to dashboard</a>

    <h2>What is this?</h2>
    <p>
      A lightweight dashboard that tracks merge request and pull request activity across
      one or more GitLab and GitHub repositories. Repositories can be organized
      by teams for filtered analysis. The dashboard provides team-level
      aggregate metrics to help managers understand team health, with
      individual contributor activity available for coaching conversations.
    </p>

    <h2>Quick start</h2>
    <ol>
      <li>Install Python dependencies: <code>pip install -r requirements.txt</code></li>
      <li>Set your GitLab token (if using GitLab repos): <code>export GITLAB_TOKEN="glpat-..."</code></li>
      <li>Set your GitHub token (if using GitHub repos): <code>export GITHUB_TOKEN="ghp_..."</code></li>
      <li>Set your Jira token (optional): <code>export JIRA_API_TOKEN="..."</code></li>
      <li>Configure repositories in <code>repos.yaml</code></li>
      <li>Fetch data: <code>python fetch_data.py</code></li>
      <li>Serve the frontend: <code>cd frontend && python -m http.server 8080</code></li>
    </ol>

    <h2>Fetching data</h2>
    <p>
      <code>fetch_data.py</code> calls the GitLab and GitHub APIs to collect merge requests
      and pull requests, including diffs, comments, and approvals. If <code>JIRA_API_TOKEN</code>
      is set, it also extracts Jira ticket IDs from MR/PR titles and fetches their priority.
      Output is written to <code>frontend/data/data.json</code>.
    </p>
    <pre>python fetch_data.py -n 50   # fetch the 50 most recent MRs per repo (default: 20)</pre>
    <table>
      <tr><th>Variable</th><th>Required</th><th>Description</th></tr>
      <tr><td><code>GITLAB_TOKEN</code></td><td>If GitLab repos configured</td><td>GitLab PAT with <code>read_api</code> scope</td></tr>
      <tr><td><code>GITHUB_TOKEN</code></td><td>If GitHub repos configured</td><td>GitHub PAT with <code>repo</code> scope (or fine-grained with read access)</td></tr>
      <tr><td><code>JIRA_API_TOKEN</code></td><td>No</td><td>Jira PAT for bug priority lookup (issues.redhat.com)</td></tr>
    </table>

    <h2>Repository configuration</h2>
    <p>Repositories are organized by team in <code>repos.yaml</code> at the project root.</p>
    <pre>repositories:
  backend-team:
    - url: https://gitlab.com/org/api-service
    - url: https://github.com/org/user-service
  frontend-team:
    - url: https://github.com/org/web-app
  docs-team:
    - url: https://gitlab.com/org/documentation</pre>
    <p>
      Both GitLab (<code>https://gitlab.com/...</code>) and GitHub
      (<code>https://github.com/...</code>) URLs are supported and can be
      mixed freely. The forge is detected automatically from the URL prefix.
      The team-based format allows filtering contributors by team in the UI.
    </p>

    <h2>Team filtering</h2>
    <p>
      When repositories are organized by team, a team dropdown filter appears
      in the dashboard. Selecting a team filters both the repository list and
      contributor activity to show only data from that team's repositories.
    </p>
    <p>
      The "Show All Teams" option can be enabled in Settings to add an
      "All Teams" option to the dropdown, allowing you to view cross-team activity.
    </p>

    <h2>Team aggregate metrics</h2>
    <p>
      The dashboard displays 8 team-level aggregate metrics with trend indicators
      comparing the current period to the previous period:
    </p>
    <table>
      <tr><th>Metric</th><th>Description</th></tr>
      <tr><td><strong>Merged MRs</strong></td><td>Total count of merged merge requests in the period</td></tr>
      <tr><td><strong>Median Lead Time</strong></td><td>Median number of days from MR creation to merge</td></tr>
      <tr><td><strong>Median Turnaround</strong></td><td>Median hours from MR creation to first non-author comment</td></tr>
      <tr><td><strong>AI Co-Author Rate</strong></td><td>Percentage of MRs that were co-authored with AI tools</td></tr>
      <tr><td><strong>AI Adoption</strong></td><td>Percentage of contributors with AI usage at or above the configured threshold</td></tr>
      <tr><td><strong>Review Coverage</strong></td><td>Percentage of merged MRs that received at least one approval</td></tr>
      <tr><td><strong>Active Contributors</strong></td><td>Count of contributors with any activity (MRs, comments, or reviews)</td></tr>
      <tr><td><strong>Lines Changed</strong></td><td>Total lines added plus deleted across all MRs</td></tr>
    </table>
    <p>
      Trend arrows indicate whether each metric improved or worsened compared to the
      previous period. For lead time and turnaround, a decrease (faster) is shown as positive.
    </p>

    <h2>Individual contributors</h2>
    <p>
      The collapsible "Individual Contributors" section lists all active contributors
      alphabetically with activity mini-badges showing merged MRs, open/closed MRs,
      reviews, and comments. Click a contributor to open their detail view with:
    </p>
    <ul>
      <li><strong>Activity Summary</strong> &mdash; Total MRs, Merged MRs, Comments, Reviews Given, Avg Lead Time, AI Co-Authored %</li>
      <li><strong>Activity Charts</strong> &mdash; MRs Merged, Comments, Approvals, AI Co-Authored (over time)</li>
      <li><strong>Top Collaborators</strong> &mdash; People they review, comment on, and co-author with</li>
      <li><strong>Repositories</strong> &mdash; Breakdown of activity by repository</li>
      <li><strong>Recent Merge Requests</strong> &mdash; Latest MRs with status and links</li>
    </ul>

    <h2>AI co-authorship detection</h2>
    <p>
      MR descriptions are scanned for trailers that indicate collaboration with
      AI tools. When a match is found the MR is flagged as AI co-authored.
    </p>
    <p><strong>Recognized trailers:</strong></p>
    <ul>
      <li><code>Co-Authored-By:</code></li>
      <li><code>Generated-By:</code> / <code>Assisted-By:</code> / <code>AI-Agent:</code></li>
      <li><code>Generated with:</code> / <code>Created with:</code> / <code>Built with:</code> / <code>Powered by:</code></li>
    </ul>
    <p>
      The value after the trailer is checked against known AI tool names:
      Claude, ChatGPT, Copilot, Gemini, Cursor, Codeium, Tabnine, Windsurf,
      and others. Only trailers that reference an AI tool are counted &mdash; human
      co-authors are ignored.
    </p>
    <p>
      Example MR description line:
    </p>
    <pre>Co-Authored-By: Claude &lt;noreply@anthropic.com&gt;</pre>

    <h2>Timeline &amp; period filtering</h2>
    <p>
      The timeline chart shows MR activity over time. The granularity buttons
      (Day / Week / Month / Year / Custom) control the chart grouping.
      Clicking a bar in the chart filters the aggregate metrics and contributor
      list to that specific period. Click the same bar again to clear the filter.
    </p>

    <h2>Settings</h2>
    <p>
      The Settings modal provides two options:
    </p>
    <ul>
      <li><strong>Show "All Teams" filter</strong> &mdash; Adds an "All Teams" option to the team dropdown for cross-team views</li>
      <li><strong>AI Adoption Threshold</strong> &mdash; The percentage of AI co-authored MRs a contributor needs to be counted in the AI Adoption metric (default: 30%)</li>
    </ul>

    <h2>PDF export</h2>
    <p>
      Click the <strong>PDF</strong> button in the header to generate a Team Activity Report
      with the timeline chart, aggregate metrics table, and alphabetical contributor list.
    </p>
    <p>
      From a contributor's detail view, click <strong>PDF</strong> to generate an
      Individual Activity Report with their metrics, charts, repository breakdown,
      and recent merge requests.
    </p>
  </div>

  <script>
    // Theme toggle (reused from main app)
    const themeToggle = document.getElementById("theme-toggle");
    const themeIcon = document.getElementById("theme-icon");
    function applyTheme(t) {
      document.documentElement.setAttribute("data-theme", t);
      themeIcon.textContent = t === "dark" ? "\u263E" : "\u2600";
    }
    applyTheme(localStorage.getItem("theme") || "dark");
    themeToggle.addEventListener("click", () => {
      const next = document.documentElement.getAttribute("data-theme") === "dark" ? "light" : "dark";
      localStorage.setItem("theme", next);
      applyTheme(next);
    });
  </script>
</body>
</html>
